```mermaid
flowchart TD
    A([старт]) --> B[задать размеры 10000 100000 1000000]
    B --> C[вывести заголовок csv]
    C --> D{есть следующий n}
    D -- да --> E[сгенерировать массив случайных чисел]
    E --> F[сумма global]
    F --> G[сумма shared]
    G --> H{sum_global равно sum_shared}
    H -- да --> I[sum_ok = 1]
    H -- нет --> J[sum_ok = 0]
    I --> K[сортировка gpu]
    J --> K
    K --> L{массив отсортирован}
    L -- да --> M[sort_ok = 1]
    L -- нет --> N[sort_ok = 0]
    M --> O[вывести строку csv]
    N --> O
    O --> D
    D -- нет --> P([конец])

    subgraph R1["сумма global"]
        R1a[выделить data и sum на gpu] --> R1b[скопировать data на gpu]
        R1b --> R1c[обнулить sum]
        R1c --> R1d[запуск atomicAdd по элементам]
        R1d --> R1e[замер времени и синхронизация]
        R1e --> R1f[скопировать sum на cpu]
        R1f --> R1g[освободить память gpu]
    end

    subgraph R2["сумма shared"]
        R2a[выделить data и sum на gpu] --> R2b[скопировать data на gpu]
        R2b --> R2c[обнулить sum]
        R2c --> R2d[загрузить блок в shared]
        R2d --> R2e[редукция внутри блока]
        R2e --> R2f[atomicAdd один раз на блок]
        R2f --> R2g[замер времени и синхронизация]
        R2g --> R2h[скопировать sum на cpu]
        R2h --> R2i[освободить память gpu]
    end

    subgraph S["сортировка gpu"]
        S1[выделить буферы a и b на gpu] --> S2[скопировать массив в a]
        S2 --> S3[отсортировать чанки пузырьком]
        S3 --> S4[seg = 32]
        S4 --> S5{seg меньше n}
        S5 -- да --> S6{seg маленький}
        S6 -- да --> S7[слияние через shared]
        S6 -- нет --> S8[слияние через global]
        S7 --> S9[переключить буферы]
        S8 --> S9
        S9 --> S10[seg = seg умножить 2]
        S10 --> S5
        S5 -- нет --> S11[скопировать итог на cpu]
        S11 --> S12[проверить сортировку]
        S12 --> S13[освободить память gpu]
    end

    F --> R1a
    G --> R2a
    K --> S1
