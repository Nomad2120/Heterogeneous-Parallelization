```mermaid
flowchart TD
    A([старт]) --> B[задать размеры: 10000 100000 1000000]
    B --> C[записать заголовок csv]
    C --> D{взять следующий размер n}
    D -- да --> E[сгенерировать массив n случайных чисел]
    E --> F[редукция global: копия на gpu, atomic сумма, замер времени]
    F --> G[редукция shared: копия на gpu, редукция в блоках, замер времени]
    G --> H[проверить sum_ok: sum_global == sum_shared]
    H --> I[сортировка gpu: пузырек на чанках, затем merge по сегментам]
    I --> J[проверить sort_ok: массив отсортирован]
    J --> K[вывести строку csv]
    K --> D
    D -- нет --> L([конец])

    subgraph R1["редукция global"]
        R1a[выделить gpu память data и sum] --> R1b[скопировать data на gpu]
        R1b --> R1c[обнулить sum]
        R1c --> R1d[запуск atomicAdd по всем элементам]
        R1d --> R1e[синхронизация и замер времени]
        R1e --> R1f[скопировать sum на cpu]
        R1f --> R1g[освободить gpu память]
    end

    subgraph R2["редукция shared"]
        R2a[выделить gpu память data и sum] --> R2b[скопировать data на gpu]
        R2b --> R2c[обнулить sum]
        R2c --> R2d[копия в shared на блок]
        R2d --> R2e[редукция внутри блока]
        R2e --> R2f[atomicAdd 1 раз на блок]
        R2f --> R2g[синхронизация и замер времени]
        R2g --> R2h[скопировать sum на cpu]
        R2h --> R2i[освободить gpu память]
    end

    subgraph S["сортировка gpu"]
        S1[выделить gpu буферы a и b] --> S2[скопировать массив в a]
        S2 --> S3[пузырек на чанках: local[32] в каждом потоке]
        S3 --> S4[seg = 32]
        S4 --> S5{seg < n}
        S5 -- да --> S6{seg маленький}
        S6 -- да --> S7[merge через shared]
        S6 -- нет --> S8[merge через global]
        S7 --> S9[flip буферы]
        S8 --> S9
        S9 --> S10[seg *= 2]
        S10 --> S5
        S5 -- нет --> S11[скопировать итог на cpu]
        S11 --> S12[проверить сортировку]
        S12 --> S13[освободить gpu память]
    end
