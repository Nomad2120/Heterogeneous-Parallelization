```mermaid
flowchart TD
    A([старт]) --> B[задать threads blocks capacity]
    B --> C[выделить память gpu]
    C --> D[запуск stack_kernel]
    D --> E[копировать gpu -> cpu]
    E --> F[посчитать push успешно]
    F --> G[проверить pop значения]
    G --> H{pop ошибка = 0}
    H -- нет --> Z[проверка: неуспешно]
    H -- да --> I[ожидалось top = push - pop]
    I --> J{top совпал}
    J -- нет --> Z
    J -- да --> K[проверка: успешно]
    K --> L([конец])

    subgraph GPU["CUDA ядро: stack_kernel"]
        K1[tid = global id] --> K2{tid = 0}
        K2 -- да --> K3[top = 0]
        K2 -- нет --> K4[пропустить]
        K3 --> K5[barrier]
        K4 --> K5

        K5 --> K6{tid четный}
        K6 -- да --> P1[push: pos = atomicAdd top]
        P1 --> P2{pos < capacity}
        P2 -- да --> P3[data pos = tid]
        P2 -- нет --> P4[откат top]

        K6 -- нет --> Q1[pop: pos = atomicSub top - 1]
        Q1 --> Q2{pos >= 0}
        Q2 -- да --> Q3[v = data pos]
        Q2 -- нет --> Q4[откат top]
    end
