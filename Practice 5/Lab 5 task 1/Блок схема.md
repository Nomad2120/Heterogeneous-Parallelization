```mermaid
flowchart TD
    A([старт]) --> B[задать threads blocks capacity]
    B --> C[выделить память gpu: stack top результаты]
    C --> D[запуск kernel стека]
    D --> E[копировать данные gpu -> cpu]
    E --> F[подсчитать push успешно]
    F --> G[проверить pop значения]
    G --> H{pop ошибка = 0}
    H -- нет --> Z[проверка: неуспешно]
    H -- да --> I[ожидалось top = push - pop]
    I --> J{top совпал}
    J -- нет --> Z
    J -- да --> K[проверка: успешно]
    K --> L([конец])

    subgraph KERNEL
        K1[init top = 0] --> K2[tid = global id]
        K2 --> K3{tid четный}
        K3 -- да --> K4[push tid]
        K4 --> K5{pos < capacity}
        K5 -- да --> K6[data pos = tid]
        K5 -- нет --> K7[откат top]
        K3 -- нет --> K8[pop]
        K8 --> K9{pos >= 0}
        K9 -- да --> K10[v = data pos]
        K9 -- нет --> K11[откат top]
    end
