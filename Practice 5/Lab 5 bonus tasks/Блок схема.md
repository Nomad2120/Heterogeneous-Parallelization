```mermaid
flowchart TD
    A([старт]) --> B[задать threads blocks capacity]
    B --> C[выделить память gpu: buf head tail enq_succ deq_succ]
    C --> D[обнулить enq_succ deq_succ]
    D --> E[создать cudaEvent]
    E --> F[запуск ядра enqueue + замер]
    F --> G[запуск ядра dequeue + замер]
    G --> H[скопировать enq_succ deq_succ на cpu]
    H --> I[запустить cpu очередь + замер]
    I --> J[запустить cpu стек + замер]
    J --> K[вывести результаты и сравнение]
    K --> L([конец])

    subgraph ENQ["GPU: enqueue"]
        E1[ok shared = 0] --> E2[tid = global id]
        E2 --> E3[enqueue: pos = atomicAdd tail]
        E3 --> E4{pos < cap}
        E4 -- да --> E5[buf pos = tid]
        E5 --> E6[ok shared++]
        E4 -- нет --> E7[откат tail]
        E6 --> E8{threadIdx = 0}
        E7 --> E8
        E8 -- да --> E9[enq_succ += ok shared]
    end

    subgraph DEQ["GPU: dequeue"]
        D1[ok shared = 0] --> D2[dequeue: pos = atomicAdd head]
        D2 --> D3[прочитать tail now]
        D3 --> D4{pos < tail now}
        D4 -- да --> D5[v = buf pos]
        D5 --> D6[ok shared++]
        D4 -- нет --> D7[откат head]
        D6 --> D8{threadIdx = 0}
        D7 --> D8
        D8 -- да --> D9[deq_succ += ok shared]
    end

