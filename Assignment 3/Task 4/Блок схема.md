
flowchart TD
    A([старт]) --> B{N > 0}
    B -- нет --> Z1[вывод N неверный] --> Z2([конец])
    B -- да --> C[задать N]
    C --> D[создать h_a h_b и заполнить]
    D --> E[выделить память gpu a b c]
    E --> F{cuda ok}
    F -- нет --> X1[вывод ошибка cuda] --> X2([конец])
    F -- да --> G[скопировать a b на gpu]
    G --> H{cuda ok}
    H -- нет --> X1

    H -- да --> I[bad cfg block 32]
    I --> J[grid bad = ceil N block]
    J --> K[запуск add и замер bad]
    K --> L{kernel ok}
    L -- нет --> X1

    L -- да --> M[good cfg block 256]
    M --> N[grid good = ceil N block]
    N --> O[запуск add и замер good]
    O --> P{kernel ok}
    P -- нет --> X1

    P -- да --> Q{good быстрее}
    Q -- да --> R[ускорение = bad good]
    Q -- нет --> S[ускорение = 1 или меньше]
    R --> T[вывести bad good ускорение]
    S --> T
    T --> U[освободить память]
    U --> V([конец])

    subgraph ADD["GPU add"]
        A1[tid = global id] --> A2{tid < N}
        A2 -- да --> A3[c tid = a tid + b tid]
        A2 -- нет --> A4[ничего]
    end
