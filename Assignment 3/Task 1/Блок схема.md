```mermaid
flowchart TD
    A([старт]) --> B{N > 0}
    B -- нет --> Z1[вывод: N неверный] --> Z2([конец])
    B -- да --> C[задать N k block]
    C --> D[создать массив h и заполнить]
    D --> E[выделить память gpu: d]
    E --> F{cuda ok}
    F -- нет --> X1[вывод: ошибка cuda] --> X2([конец])
    F -- да --> G[скопировать h -> d]
    G --> H{cuda ok}
    H -- нет --> X1
    H -- да --> I[создать cudaEvent]

    I --> J[запуск global + замер]
    J --> K{kernel ok}
    K -- нет --> X1
    K -- да --> L[сброс данных: снова h -> d]
    L --> M{cuda ok}
    M -- нет --> X1
    M -- да --> N{shared bytes = block * sizeof(float)}
    N -- много --> X1
    N -- нормально --> O[запуск shared + замер]
    O --> P{kernel ok}
    P -- нет --> X1
    P -- да --> Q{shared быстрее}
    Q -- да --> R[вывод: shared быстрее]
    Q -- нет --> S[вывод: global быстрее или равно]
    R --> T[вывести времена]
    S --> T
    T --> U[освободить память]
    U --> V([конец])

    subgraph GLOB["GPU: global"]
        G1[tid = global id] --> G2{tid < N}
        G2 -- да --> G3[a tid = a tid * k]
        G2 -- нет --> G4[ничего]
    end

    subgraph SHRD["GPU: shared"]
        S1[tid = global id] --> S2{tid < N}
        S2 -- да --> S3[sh local = a tid]
        S2 -- нет --> S4[ничего]
        S3 --> S5[barrier]
        S5 --> S6[sh local = sh local * k]
        S6 --> S7[barrier]
        S7 --> S8[a tid = sh local]
    end

