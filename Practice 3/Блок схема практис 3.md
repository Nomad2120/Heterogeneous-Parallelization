```mermaid
flowchart TD
    A(start) --> B(practice3)
    B --> C(run_n_10000)
    C --> D(run_n_100000)
    D --> E(run_n_1000000)
    E --> F(return_0)

    %% run_n(n)
    C --> C1(create_vector_a)
    C1 --> C2(fill_random_mt19937)
    C2 --> C3(print_size)

    C3 --> C4(cpu_merge_time)
    C4 --> C5(cpu_quick_time)
    C5 --> C6(cpu_heap_time)

    C6 --> C7(cuda_warmup_free0)
    C7 --> C8(gpu_sort_merge)
    C8 --> C9(gpu_sort_quick)
    C9 --> C10(gpu_sort_heap)

    %% cpu_time(fn, input)
    C4 --> T1(copy_input_to_local_a)
    T1 --> T2(start_timer_cpu)
    T2 --> T3(call_cpu_sort_fn)
    T3 --> T4(stop_timer_cpu)
    T4 --> T5(check_is_sorted_cpu)
    T5 --> T6(return_cpu_ms)

    %% gpu_sort(mode, input)
    C8 --> G1(cudaMalloc_d_in_d_tmp)
    G1 --> G2(cudaMemcpy_H2D)
    G2 --> G3(create_cuda_events)
    G3 --> G4(record_start)
    G4 --> G5(calc_blocks_chunks)

    %% choose chunk sort kernel by mode
    G5 --> K1{mode}
    K1 -->|0| K2(kernel_chunk_bitonic)
    K1 -->|1| K3(kernel_chunk_quick_simple)
    K1 -->|2| K4(kernel_chunk_heap_simple)

    K2 --> G6(sync_after_chunk_sort
)
    K3 --> G6
    K4 --> G6

    G6 --> G7(init_src_dst_ptrs)
    G7 --> G8(loop_w_doubles)

    %% merge loop
    G8 --> M1(calc_pairs)
    M1 --> M2(kernel_merge_pass)
    M2 --> M3(sync_after_merge)
    M3 --> M4(swap_src_dst)
    M4 --> G8

    %% finish gpu_sort
    G8 --> G9(if_src_not_d_in_copy_back)
    G9 --> G10(record_end)
    G10 --> G11(elapsed_time_ms)
    G11 --> G12(cudaMemcpy_D2H_result)
    G12 --> G13(check_is_sorted_gpu)
    G13 --> G14(free_gpu_memory)
    G14 --> G15(destroy_events)
    G15 --> G16(return_gpu_ms)

    %% kernels (high-level)
    K2 --> KB1(load_chunk_to_shared_or_INF)
    KB1 --> KB2(bitonic_compare_swap_loops)
    KB2 --> KB3(store_sorted_chunk)

    K3 --> KQ1(load_chunk_to_shared_or_INF)
    KQ1 --> KQ2(tid0_insertion_sort)
    KQ2 --> KQ3(store_sorted_chunk)

    K4 --> KH1(load_chunk_to_shared_or_INF)
    KH1 --> KH2(tid0_heap_sort_chunk)
    KH2 --> KH3(store_sorted_chunk)

    M2 --> MP1(one_block_one_pair)
    MP1 --> MP2(tid0_merge_two_runs)
    MP2 --> MP3(write_merged_run)
